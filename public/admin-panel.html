<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Panel - Jadwal Kelas</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700&family=Patrick+Hand&display=swap" rel="stylesheet" />
    <style>
      :root {
        --deep-blue: #0d47a1;
        --primary-blue: #1e88e5;
        --light-blue: #bbdefb;
        --steel-gray: #546e7a;
        --light-gray: #e0e0e0;
        --white: #ffffff;
        --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        --shadow: 0 3px 6px rgba(0, 0, 0, 0.16);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Nunito", sans-serif;
        background-color: #f5f7fa;
        color: #333;
        line-height: 1.6;
      }

      .container {
        width: 100%;
        padding: 0 15px;
        margin: 0 auto;
      }

      header {
        background: linear-gradient(135deg, var(--deep-blue), var(--primary-blue));
        color: white;
        padding: 30px 0;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .header-content {
        text-align: center;
      }

      .page-title {
        font-family: "Patrick Hand", cursive;
        font-size: 2.5rem;
        margin-bottom: 10px;
      }

      .page-subtitle {
        font-size: 1.2rem;
        opacity: 0.9;
      }

      /* Admin Container Styles */
      .admin-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
      }

      .admin-header {
        text-align: center;
        margin-bottom: 30px;
      }

      .admin-title {
        font-family: "Patrick Hand", cursive;
        font-size: 2.5rem;
        color: var(--deep-blue);
        margin-bottom: 10px;
      }

      .admin-subtitle {
        color: var(--steel-gray);
        font-size: 1.2rem;
        margin-bottom: 20px;
      }

      .admin-sections {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
      }

      .form-section,
      .schedule-section {
        flex: 1;
        min-width: 300px;
      }

      .admin-card {
        background: var(--white);
        border-radius: 16px;
        box-shadow: var(--card-shadow);
        padding: 25px;
        margin-bottom: 25px;
      }

      .admin-card h2 {
        font-family: "Nunito", sans-serif;
        color: var(--deep-blue);
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid var(--light-gray);
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: var(--steel-gray);
      }

      .form-control {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid var(--light-gray);
        border-radius: 10px;
        font-family: "Nunito", sans-serif;
        font-size: 1rem;
        transition: border-color 0.3s ease;
      }

      .form-control:focus {
        outline: none;
        border-color: var(--primary-blue);
        box-shadow: 0 0 0 3px rgba(30, 136, 229, 0.2);
      }

      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 12px 25px;
        border: none;
        border-radius: 50px;
        font-family: "Nunito", sans-serif;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        gap: 8px;
      }

      .btn-primary {
        background: var(--primary-blue);
        color: white;
        box-shadow: var(--shadow);
      }

      .btn-primary:hover {
        background: var(--deep-blue);
        transform: translateY(-3px);
        box-shadow: 0 6px 12px rgba(13, 71, 161, 0.3);
      }

      .btn-secondary {
        background: var(--steel-gray);
        color: white;
      }

      .btn-secondary:hover {
        background: #455a64;
      }

      .btn-danger {
        background: #e53935;
        color: white;
      }

      .btn-danger:hover {
        background: #c62828;
      }

      .btn-sm {
        padding: 6px 12px;
        font-size: 0.85rem;
      }

      .schedule-filters {
        display: flex;
        gap: 15px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }

      .filter-group {
        display: flex;
        gap: 10px;
        align-items: center;
      }

      .schedule-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }

      .schedule-table th,
      .schedule-table td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid var(--light-gray);
      }

      .schedule-table th {
        background: var(--light-gray);
        color: var(--steel-gray);
        font-weight: 700;
      }

      .schedule-table tr:hover {
        background: rgba(30, 136, 229, 0.05);
      }

      .actions-cell {
        display: flex;
        gap: 8px;
      }

      .icon-cell {
        text-align: center;
        font-size: 1.5rem;
      }

      .hidden {
        display: none;
      }

      .message {
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 20px;
        text-align: center;
      }

      .message-success {
        background: #e8f5e9;
        color: #2e7d32;
        border: 1px solid #c8e6c9;
      }

      .message-error {
        background: #ffebee;
        color: #c62828;
        border: 1px solid #ffcdd2;
      }

      .loading {
        text-align: center;
        padding: 20px;
        color: var(--steel-gray);
      }

      .loading-spinner {
        border: 4px solid rgba(0, 0, 0, 0.1);
        border-left-color: var(--primary-blue);
        border-radius: 50%;
        width: 30px;
        height: 30px;
        animation: spin 1s linear infinite;
        margin: 0 auto 10px;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .footer-nav {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-top: 30px;
        padding: 20px 0;
      }

      .nav-btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        padding: 10px 20px;
        background: var(--primary-blue);
        color: white;
        border: none;
        border-radius: 50px;
        font-family: "Nunito", sans-serif;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.3s ease;
        gap: 8px;
      }

      .nav-btn:hover {
        background: var(--deep-blue);
      }

      .icon-preview {
        display: inline-block;
        width: 30px;
        text-align: center;
        margin-right: 10px;
      }

      /* Modal Styles */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        justify-content: center;
        align-items: center;
      }

      .modal-content {
        background: var(--white);
        border-radius: 16px;
        box-shadow: var(--card-shadow);
        padding: 30px;
        width: 90%;
        max-width: 500px;
        text-align: center;
        animation: modalOpen 0.3s ease;
      }

      @keyframes modalOpen {
        from {
          opacity: 0;
          transform: translateY(-30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .modal-title {
        font-size: 1.8rem;
        color: var(--deep-blue);
        margin-bottom: 15px;
      }

      .modal-message {
        font-size: 1.1rem;
        color: var(--steel-gray);
        margin-bottom: 25px;
      }

      .modal-actions {
        display: flex;
        justify-content: center;
        gap: 15px;
      }

      .modal-btn {
        padding: 12px 30px;
        min-width: 120px;
      }

      .modal-highlight {
        font-weight: 700;
        color: var(--deep-blue);
      }
    </style>
  </head>
  <body>
    <header>
      <div class="container header-content">
        <h1 class="page-title">Admin Panel</h1>
        <p class="page-subtitle">Kelola Jadwal Kelas XI</p>
      </div>
    </header>

    <div class="container admin-container">
      <div id="messageArea"></div>

      <div class="admin-sections">
        <div class="form-section">
          <div class="admin-card">
            <h2 id="formTitle">Tambah Jadwal Baru</h2>
            <form id="scheduleForm">
              <input type="hidden" id="scheduleId" />
              <div class="form-group">
                <label for="classSelect">Kelas</label>
                <select class="form-control" id="classSelect" required>
                  <option value="">Pilih Kelas</option>
                  <option value="XI A">XI A</option>
                  <option value="XI B">XI B</option>
                </select>
              </div>
              <div class="form-group">
                <label for="daySelect">Hari</label>
                <select class="form-control" id="daySelect" required>
                  <option value="">Pilih Hari</option>
                  <option value="Senin">Senin</option>
                  <option value="Selasa">Selasa</option>
                  <option value="Rabu">Rabu</option>
                  <option value="Kamis">Kamis</option>
                  <option value="Jumat">Jumat</option>
                </select>
              </div>
              <div class="form-group">
                <label for="subjectInput">Mata Pelajaran</label>
                <input type="text" class="form-control" id="subjectInput" placeholder="Masukkan mata pelajaran" required />
              </div>
              <div class="form-group">
                <label for="teacherInput">Nama Guru</label>
                <input type="text" class="form-control" id="teacherInput" placeholder="Masukkan nama guru" required />
              </div>
              <div class="form-group">
                <label for="iconSelect">Ikon Mata Pelajaran</label>
                <select class="form-control" id="iconSelect" required>
                  <option value="">Pilih Ikon</option>
                  <option value="fa-book">Buku (Umum)</option>
                  <option value="fa-calculator">Matematika</option>
                  <option value="fa-flask">Kimia</option>
                  <option value="fa-atom">Fisika</option>
                  <option value="fa-dna">Biologi</option>
                  <option value="fa-globe-asia">Geografi</option>
                  <option value="fa-landmark">Sejarah</option>
                  <option value="fa-language">Bahasa</option>
                  <option value="fa-running">PJOK</option>
                  <option value="fa-music">Seni Musik</option>
                  <option value="fa-palette">Seni Rupa</option>
                  <option value="fa-laptop-code">Informatika</option>
                  <option value="fa-pray">Agama</option>
                  <option value="fa-chart-line">Ekonomi</option>
                </select>
              </div>
              <div class="form-group">
                <label for="startTimeInput">Waktu Mulai</label>
                <input type="time" class="form-control" id="startTimeInput" required />
              </div>
              <div class="form-group">
                <label for="endTimeInput">Waktu Selesai</label>
                <input type="time" class="form-control" id="endTimeInput" required />
              </div>
              <div class="form-group">
                <button type="submit" class="btn btn-primary" id="submitBtn">Tambah Jadwal</button>
                <button type="button" class="btn btn-secondary hidden" id="cancelEditBtn">Batal</button>
              </div>
            </form>
          </div>
        </div>

        <div class="schedule-section">
          <div class="admin-card">
            <h2>Daftar Jadwal</h2>
            <div class="schedule-filters">
              <div class="filter-group">
                <label for="filterClass">Kelas:</label>
                <select class="form-control" id="filterClass">
                  <option value="">Semua</option>
                  <option value="XI A">XI A</option>
                  <option value="XI B">XI B</option>
                </select>
              </div>
              <div class="filter-group">
                <label for="filterDay">Hari:</label>
                <select class="form-control" id="filterDay">
                  <option value="">Semua</option>
                  <option value="Senin">Senin</option>
                  <option value="Selasa">Selasa</option>
                  <option value="Rabu">Rabu</option>
                  <option value="Kamis">Kamis</option>
                  <option value="Jumat">Jumat</option>
                </select>
              </div>
              <button class="btn btn-primary" id="refreshBtn"><i class="fas fa-sync-alt"></i> Refresh</button>
            </div>
            <div id="scheduleList">
              <div class="loading">
                <div class="loading-spinner"></div>
                Memuat jadwal...
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="footer-nav">
        <button class="nav-btn" onclick="window.location.href='index.html'"><i class="fas fa-arrow-left"></i> Kembali</button>
        <button class="nav-btn" onclick="window.location.href='jadwal.html'"><i class="fas fa-calendar-alt"></i> Lihat Jadwal</button>
      </div>

      <div id="deleteModal" class="modal">
        <div class="modal-content">
          <h3 class="modal-title"><i class="fas fa-exclamation-triangle"></i> Konfirmasi Hapus</h3>
          <p class="modal-message">Apakah Anda yakin ingin menghapus jadwal <span id="scheduleName" class="modal-highlight"></span>?</p>
          <div class="modal-actions">
            <button id="confirmDeleteBtn" class="btn btn-danger modal-btn">Hapus</button>
            <button id="cancelDeleteBtn" class="btn btn-secondary modal-btn">Batal</button>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Konfigurasi API - Sesuaikan dengan URL API Anda
      const API_BASE = "/api";
      const JADWAL_API = `${API_BASE}/jadwal`;

      // DOM Elements
      const scheduleForm = document.getElementById("scheduleForm");
      const scheduleIdInput = document.getElementById("scheduleId");
      const classSelect = document.getElementById("classSelect");
      const daySelect = document.getElementById("daySelect");
      const subjectInput = document.getElementById("subjectInput");
      const teacherInput = document.getElementById("teacherInput");
      const iconSelect = document.getElementById("iconSelect");
      const startTimeInput = document.getElementById("startTimeInput");
      const endTimeInput = document.getElementById("endTimeInput");
      const submitBtn = document.getElementById("submitBtn");
      const cancelEditBtn = document.getElementById("cancelEditBtn");
      const filterClass = document.getElementById("filterClass");
      const filterDay = document.getElementById("filterDay");
      const refreshBtn = document.getElementById("refreshBtn");
      const scheduleList = document.getElementById("scheduleList");
      const messageArea = document.getElementById("messageArea");
      const formTitle = document.getElementById("formTitle");

      // Modal Elements
      const deleteModal = document.getElementById("deleteModal");
      const scheduleNameSpan = document.getElementById("scheduleName");
      const confirmDeleteBtn = document.getElementById("confirmDeleteBtn");
      const cancelDeleteBtn = document.getElementById("cancelDeleteBtn");

      let schedules = []; // Menyimpan data jadwal
      let scheduleToDelete = null; // Menyimpan jadwal yang akan dihapus

      // Fungsi untuk menampilkan pesan
      function showMessage(message, type = "success") {
        messageArea.innerHTML = `
          <div class="message message-${type}">
            ${message}
          </div>
        `;
        setTimeout(() => {
          messageArea.innerHTML = "";
        }, 5000);
      }

      // Fungsi untuk memuat jadwal dari API
      async function loadSchedules() {
        try {
          scheduleList.innerHTML = `
            <div class="loading">
              <div class="loading-spinner"></div>
              Memuat jadwal...
            </div>
          `;

          const response = await fetch(JADWAL_API);

          if (!response.ok) {
            throw new Error(`Gagal memuat jadwal: ${response.status}`);
          }

          schedules = await response.json();
          renderSchedules();
        } catch (error) {
          scheduleList.innerHTML = `
            <div class="message message-error">
              ${error.message || "Gagal memuat jadwal"}
            </div>
          `;
          console.error("Error loading schedules:", error);
        }
      }

      // Fungsi untuk merender jadwal dalam tabel
      function renderSchedules() {
        const selectedClass = filterClass.value;
        const selectedDay = filterDay.value;

        // Filter jadwal (case insensitive)
        let filteredSchedules = schedules;
        if (selectedClass) {
          filteredSchedules = filteredSchedules.filter((s) => s.class.toLowerCase() === selectedClass.toLowerCase());
        }
        if (selectedDay) {
          filteredSchedules = filteredSchedules.filter((s) => s.day.toLowerCase() === selectedDay.toLowerCase());
        }

        // Sort by day and start time
        const dayOrder = ["Senin", "Selasa", "Rabu", "Kamis", "Jumat"];
        filteredSchedules.sort((a, b) => {
          if (a.day !== b.day) {
            return dayOrder.indexOf(a.day) - dayOrder.indexOf(b.day);
          }
          return a.startTime.localeCompare(b.startTime);
        });

        if (filteredSchedules.length === 0) {
          scheduleList.innerHTML = '<div class="message">Tidak ada jadwal ditemukan</div>';
          return;
        }

        let tableHTML = `
          <table class="schedule-table">
            <thead>
              <tr>
                <th>Ikon</th>
                <th>Kelas</th>
                <th>Hari</th>
                <th>Mata Pelajaran</th>
                <th>Guru</th>
                <th>Waktu</th>
                <th>Aksi</th>
              </tr>
            </thead>
            <tbody>
        `;

        filteredSchedules.forEach((schedule) => {
          tableHTML += `
            <tr>
              <td class="icon-cell"><i class="fas ${schedule.icon}"></i></td>
              <td>${schedule.class}</td>
              <td>${schedule.day}</td>
              <td>${schedule.subject}</td>
              <td>${schedule.teacher}</td>
              <td>${schedule.startTime} - ${schedule.endTime}</td>
              <td class="actions-cell">
                <button class="btn btn-primary btn-sm" onclick="editSchedule('${schedule.id}')">
                  <i class="fas fa-edit"></i> Edit
                </button>
                <button class="btn btn-danger btn-sm" onclick="deleteSchedule('${schedule.id}')">
                  <i class="fas fa-trash"></i> Hapus
                </button>
              </td>
            </tr>
          `;
        });

        tableHTML += `
            </tbody>
          </table>
        `;

        scheduleList.innerHTML = tableHTML;
      }

      // Fungsi untuk mengedit jadwal
      function editSchedule(id) {
        const schedule = schedules.find((s) => s.id === id);
        if (!schedule) return;

        // Isi form dengan data jadwal
        scheduleIdInput.value = schedule.id;
        classSelect.value = schedule.class;
        daySelect.value = schedule.day;
        subjectInput.value = schedule.subject;
        teacherInput.value = schedule.teacher;
        iconSelect.value = schedule.icon;
        startTimeInput.value = schedule.startTime;
        endTimeInput.value = schedule.endTime;

        // Ubah tombol submit menjadi "Update"
        submitBtn.textContent = "Update Jadwal";
        formTitle.textContent = "Edit Jadwal";
        cancelEditBtn.classList.remove("hidden");

        // Scroll ke form
        document.querySelector(".form-section").scrollIntoView({ behavior: "smooth" });
      }

      // Fungsi untuk membatalkan edit
      function cancelEdit() {
        scheduleForm.reset();
        scheduleIdInput.value = "";
        submitBtn.textContent = "Tambah Jadwal";
        formTitle.textContent = "Tambah Jadwal Baru";
        cancelEditBtn.classList.add("hidden");
      }

      function showDeleteConfirmation(schedule) {
        if (!schedule) {
          console.error("Schedule data is null or undefined");
          return;
        }

        scheduleToDelete = schedule;
        scheduleNameSpan.textContent = `${schedule.subject} (${schedule.day}, ${schedule.class})`;
        deleteModal.style.display = "flex";
      }

      // Fungsi untuk menyembunyikan modal konfirmasi
      function hideDeleteConfirmation() {
        deleteModal.style.display = "none";
        scheduleToDelete = null;
      }

      // Fungsi untuk menghapus jadwal
      function deleteSchedule(id) {
        const schedule = schedules.find((s) => s.id === id);
        if (!schedule) return;

        showDeleteConfirmation(schedule);
      }

      confirmDeleteBtn.addEventListener("click", async () => {
        if (!scheduleToDelete) return;

        const deletedSubject = scheduleToDelete.subject; // Simpan dulu sebelum null
        const deletedClass = scheduleToDelete.class;
        const deletedDay = scheduleToDelete.day;
        const id = scheduleToDelete.id;

        hideDeleteConfirmation(); // Ini akan set scheduleToDelete = null

        try {
          // Tampilkan loading
          scheduleList.innerHTML = `
      <div class="loading">
        <div class="loading-spinner"></div>
        Menghapus jadwal...
      </div>
    `;

          const response = await fetch(`${JADWAL_API}?id=${id}`, {
            method: "DELETE",
          });

          if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.error || "Gagal menghapus jadwal");
          }

          showMessage(`Jadwal "${deletedSubject}" (${deletedDay}, ${deletedClass}) berhasil dihapus`, "success");
          await loadSchedules();
        } catch (error) {
          showMessage(error.message || "Terjadi kesalahan pada server", "error");
          console.error("Delete error:", error);
          await loadSchedules();
        }
      });

      // Event listener untuk tombol batal modal
      cancelDeleteBtn.addEventListener("click", hideDeleteConfirmation);

      // Event listener untuk form submit
      scheduleForm.addEventListener("submit", async (e) => {
        e.preventDefault();

        const scheduleData = {
          class: classSelect.value,
          day: daySelect.value,
          subject: subjectInput.value,
          teacher: teacherInput.value,
          icon: iconSelect.value,
          startTime: startTimeInput.value,
          endTime: endTimeInput.value,
        };

        const id = scheduleIdInput.value;
        const method = id ? "PUT" : "POST";
        const url = id ? JADWAL_API : JADWAL_API;

        try {
          // Tambahkan ID jika dalam mode edit
          if (id) {
            scheduleData.id = id;
          }

          // Kirim permintaan ke API
          const response = await fetch(url, {
            method,
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(scheduleData),
          });

          if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.error || "Terjadi kesalahan pada server");
          }

          const result = await response.json();

          if (method === "POST") {
            showMessage("Jadwal baru berhasil ditambahkan", "success");
          } else {
            showMessage("Jadwal berhasil diperbarui", "success");
          }

          cancelEdit();
          await loadSchedules(); // Muat ulang data setelah perubahan
        } catch (error) {
          showMessage(error.message || "Terjadi kesalahan pada server", "error");
          console.error("Submit error:", error);
        }
      });

      // Event listeners lainnya
      cancelEditBtn.addEventListener("click", cancelEdit);
      filterClass.addEventListener("change", renderSchedules);
      filterDay.addEventListener("change", renderSchedules);
      refreshBtn.addEventListener("click", loadSchedules);

      // Muat jadwal saat halaman dimuat
      document.addEventListener("DOMContentLoaded", loadSchedules);

      // Ekspos fungsi ke global scope agar bisa dipanggil dari onclick di button
      window.editSchedule = editSchedule;
      window.deleteSchedule = deleteSchedule;
    </script>
  </body>
</html>
s
